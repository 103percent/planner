= render partial: 'shared/title', locals: { title: "Subscriptions", date: nil }
%section#banner
.row
  .large-12.columns
    %h3 codebar newsletter
    %p.lead Stay up to date with codebar's news and opportunities by subscribing to the newsletter.
    .row
      .medium-3.columns
        - if @member.subscribed_to_newsletter?
          = simple_form_for @mailing_list, url: mailing_lists_path, method: :delete do |f|
            = f.submit "Unsubscribe from newsletter", class: 'button tiny expand success'
        - else
          = simple_form_for @mailing_list, url: mailing_lists_path do |f|
            = f.submit "Subscribe to newsletter", class: 'button tiny expand success'
%hr

.row
  .large-12.columns
    %p.lead Subscriptions control the invitation emails you receive. For example if you would like to receive student invitations for the Brighton and West London workshops then subscribe to the Brighton (Students) and West London (Students) options.
    %br
    - @groups.group_by(&:chapter).each do |chapter, groups|
      %h4= chapter.name
      %hr
      - groups.sort_by(&:name).each do |group|
        .row
          .medium-9.columns
            %p= group.name
          .medium-3.columns
            - if belongs_to_group?(group)
              = simple_form_for :subscription, method: :delete do |f|
                = f.input :subscription_id, as: :hidden, input_html: { value: nil }
                = f.input :group_id, as: :hidden, input_html: { value: group.id }
                = f.submit "Subscribed", class: 'button tiny expand success', id: "#{chapter.name.downcase}-#{group.name.downcase}"
            - else
              = simple_form_for :subscription do |f|
                = f.input :group_id, as: :hidden, input_html: { value: group.id }
                = f.submit "Subscribe", class: 'button tiny expand warn', id: "#{chapter.name.downcase}-#{group.name.downcase}"

    %hr
